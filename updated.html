<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kiwimbi Kenya Staff Attendance Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-green: #2e7d32;
            --light-green: #81c784;
            --dark-green: #1b5e20;
            --primary-blue: #1565c0;
            --light-blue: #64b5f6;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --gray: #9e9e9e;
            --dark-gray: #424242;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-green);
            color: var(--white);
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 80px;
            height: 80px;
            background-color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .logo img {
            max-width: 70%;
            max-height: 70%;
            object-fit: contain;
        }
        
        .site-title {
            font-size: 28px;
            font-weight: 700;
        }
        
        .current-date {
            background-color: var(--dark-green);
            padding: 10px 20px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 16px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 25px;
            margin-bottom: 20px;
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-title {
            color: var(--primary-green);
            font-size: 22px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title i {
            color: var(--primary-blue);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-weight: 600;
            font-size: 16px;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.2);
        }
        
        button {
            background-color: var(--primary-green);
            color: var(--white);
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background-color: var(--dark-green);
        }
        
        button.export-btn {
            background-color: var(--primary-blue);
        }
        
        button.export-btn:hover {
            background-color: #0d47a1;
        }
        
        .check-in-out {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        @media (max-width: 500px) {
            .check-in-out {
                grid-template-columns: 1fr;
            }
        }
        
        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .attendance-table th {
            background-color: var(--primary-green);
            color: var(--white);
            text-align: left;
            padding: 12px 15px;
            font-weight: 600;
        }
        
        .attendance-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .attendance-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status-late {
            color: #d32f2f;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-on-time {
            color: #2e7d32;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-checked-out {
            color: #1565c0;
            font-weight: 600;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .summary-stats {
                grid-template-columns: 1fr;
            }
        }
        
        .stat-item {
            background-color: var(--light-green);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: var(--white);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .instructions {
            background-color: #e8f5e9;
            border-left: 4px solid var(--primary-green);
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
        }
        
        .instructions ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 5px;
        }
        
        .time-display {
            font-size: 14px;
            color: var(--gray);
            margin-top: 5px;
            font-style: italic;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            background-color: #f5f5f5;
            font-weight: 600;
        }
        
        .tab.active {
            background-color: var(--primary-green);
            color: var(--white);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }
        
        .no-records {
            text-align: center;
            color: var(--gray);
            padding: 30px;
            font-style: italic;
        }
        
        footer {
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
            color: var(--dark-gray);
            font-size: 14px;
            border-top: 1px solid #ddd;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: var(--white);
            background-color: var(--primary-green);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--primary-green);
        }
        
        .notification.error {
            background-color: #d32f2f;
        }
        
        /* Icons using inline SVGs */
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo-container">
                <div class="logo">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="var(--primary-green)" width="48px" height="48px">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                </div>
                <div>
                    <h1 class="site-title">Kiwimbi Kenya</h1>
                    <p>Staff Attendance Tracker</p>
                </div>
            </div>
            <div class="current-date" id="current-date">Loading date...</div>
        </div>
    </header>

    <div class="container">
        <div class="notification" id="notification">
            Notification message
        </div>

        <div class="main-content">
            <div class="card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24px" height="24px">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Staff Check-In / Check-Out
                </h2>
                
                <div class="instructions">
                    <strong>Attendance Rules:</strong>
                    <ul>
                        <li><strong>Teaching Assistants:</strong> Must report by 7:00 AM (Monday – Thursday)</li>
                        <li><strong>Library Staff, Redwood, Tailoring:</strong> Must report by 8:00 AM (Monday – Thursday)</li>
                        <li><strong>All Staff:</strong> Must report by 8:00 AM on Friday and Saturday</li>
                    </ul>
                </div>
                
                <form id="attendance-form">
                    <div class="form-group">
                        <label for="staff-name">Staff Name</label>
                        <input type="text" id="staff-name" placeholder="Enter your full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="staff-role">Role</label>
                        <select id="staff-role" required>
                            <option value="">Select your role</option>
                            <option value="teaching-assistant">Teaching Assistant</option>
                            <option value="library-staff">Library Staff</option>
                            <option value="redwood">Redwood Department</option>
                            <option value="tailoring">Tailoring Department</option>
                        </select>
                    </div>
                    
                    <div class="check-in-out">
                        <button type="button" id="check-in-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px">
                                <path d="M0 0h24v24H0z" fill="none"/>
                                <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83v2.16h3v-2.13c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                            </svg>
                            Check In
                        </button>
                        
                        <button type="button" id="check-out-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px">
                                <path d="M0 0h24v24H0z" fill="none"/>
                                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                            </svg>
                            Check Out
                        </button>
                    </div>
                </form>
            </div>
            
            <div class="card">
                <h2 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24px" height="24px">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    Today's Attendance
                </h2>
                
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="total-staff">0</div>
                        <div class="stat-label">Total Staff</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="present-staff">0</div>
                        <div class="stat-label">Present</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="late-staff">0</div>
                        <div class="stat-label">Late</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="present">Present</div>
                    <div class="tab" data-tab="absent">Absent</div>
                </div>
                
                <div class="tab-content active" id="present-tab">
                    <table class="attendance-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Check-In</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="present-list">
                            <!-- Present staff will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="tab-content" id="absent-tab">
                    <table class="attendance-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="absent-list">
                            <!-- Absent staff will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <button class="export-btn" id="export-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18px" height="18px">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                    </svg>
                    Export to Excel
                </button>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24px" height="24px">
                    <path d="M0 0h24v24H0z" fill="none"/>
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
                Weekly Attendance Overview
            </h2>
            
            <div class="chart-container">
                <canvas id="attendance-chart"></canvas>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; <span id="current-year">2023</span> Kiwimbi Kenya. All rights reserved.</p>
            <p>Staff Attendance Tracking System</p>
        </div>
    </footer>

    <script>
        // Mock data for absent staff (this would normally come from a database)
        const mockAbsentStaff = [
            { name: "Sarah Johnson", role: "Teaching Assistant" },
            { name: "Michael Brown", role: "Library Staff" },
            { name: "Emily Davis", role: "Redwood Department" },
            { name: "David Wilson", role: "Tailoring Department" },
            { name: "Lisa Anderson", role: "Teaching Assistant" }
        ];
        
        // Store attendance records in localStorage
        let attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || [];
        let presentStaffList = [];
        
        // DOM elements
        const currentDateEl = document.getElementById('current-date');
        const staffNameInput = document.getElementById('staff-name');
        const staffRoleSelect = document.getElementById('staff-role');
        const checkInBtn = document.getElementById('check-in-btn');
        const checkOutBtn = document.getElementById('check-out-btn');
        const presentListEl = document.getElementById('present-list');
        const absentListEl = document.getElementById('absent-list');
        const totalStaffEl = document.getElementById('total-staff');
        const presentStaffEl = document.getElementById('present-staff');
        const lateStaffEl = document.getElementById('late-staff');
        const exportBtn = document.getElementById('export-btn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const notification = document.getElementById('notification');
        const currentYearEl = document.getElementById('current-year');
        
        // Set current date and year
        function updateCurrentDate() {
            const now = new Date();
            currentDateEl.textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            currentYearEl.textContent = now.getFullYear();
        }
        
        // Format time as HH:MM AM/PM
        function formatTime(date) {
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Get current day of week
        function getCurrentDay() {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            return days[new Date().getDay()];
        }
        
        // Determine if a check-in time is late based on role and day
        function isLate(role, checkInTime) {
            const day = getCurrentDay();
            const hour = checkInTime.getHours();
            const minute = checkInTime.getMinutes();
            const minutesPastMidnight = hour * 60 + minute;
            
            // Weekend rules
            if (day === 'Friday' || day === 'Saturday') {
                const eightAMMinutes = 8 * 60; // 8:00 AM
                return minutesPastMidnight > eightAMMinutes;
            }
            
            // Monday-Thursday rules
            if (day !== 'Sunday') {
                if (role === 'teaching-assistant') {
                    const sevenAMMinutes = 7 * 60; // 7:00 AM
                    return minutesPastMidnight > sevenAMMinutes;
                } else {
                    const eightAMMinutes = 8 * 60; // 8:00 AM
                    return minutesPastMidnight > eightAMMinutes;
                }
            }
            
            return false; // Not late on Sunday
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Record check-in
        function checkIn() {
            const staffName = staffNameInput.value.trim();
            const staffRole = staffRoleSelect.value;
            
            if (!staffName || !staffRole) {
                showNotification('Please enter your name and select your role', 'error');
                return;
            }
            
            const now = new Date();
            const dateString = now.toLocaleDateString();
            const checkInTimeStr = formatTime(now);
            
            // Check if already checked in today
            const existingRecord = attendanceRecords.find(record => 
                record.name === staffName && 
                record.date === dateString && 
                record.checkIn
            );
            
            if (existingRecord) {
                showNotification(`${staffName} has already checked in today at ${existingRecord.checkIn}`, 'error');
                return;
            }
            
            const isLateStatus = isLate(staffRole, now);
            const status = isLateStatus ? 'late' : 'on-time';
            
            const newRecord = {
                name: staffName,
                role: staffRole,
                date: dateString,
                checkIn: checkInTimeStr,
                checkOut: null,
                status: status,
                checkInTimestamp: now.getTime()
            };
            
            attendanceRecords.push(newRecord);
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            staffNameInput.value = '';
            staffRoleSelect.value = '';
            
            showNotification(`${staffName} checked in successfully at ${checkInTimeStr}${isLateStatus ? ' (Late)' : ''}`);
            updateAttendanceDisplay();
        }
        
        // Record check-out
        function checkOut() {
            const staffName = staffNameInput.value.trim();
            const staffRole = staffRoleSelect.value;
            
            if (!staffName || !staffRole) {
                showNotification('Please enter your name and select your role', 'error');
                return;
            }
            
            const now = new Date();
            const dateString = now.toLocaleDateString();
            const checkOutTimeStr = formatTime(now);
            
            // Find the check-in record for today
            const recordIndex = attendanceRecords.findIndex(record => 
                record.name === staffName && 
                record.date === dateString && 
                record.checkIn && 
                !record.checkOut
            );
            
            if (recordIndex === -1) {
                showNotification(`${staffName} has not checked in today or already checked out`, 'error');
                return;
            }
            
            attendanceRecords[recordIndex].checkOut = checkOutTimeStr;
            attendanceRecords[recordIndex].checkOutTimestamp = now.getTime();
            
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            
            staffNameInput.value = '';
            staffRoleSelect.value = '';
            
            showNotification(`${staffName} checked out successfully at ${checkOutTimeStr}`);
            updateAttendanceDisplay();
        }
        
        // Update the attendance display
        function updateAttendanceDisplay() {
            const today = new Date().toLocaleDateString();
            
            // Filter today's records where check-in is done but not checked out
            presentStaffList = attendanceRecords.filter(record => 
                record.date === today && 
                record.checkIn && 
                !record.checkOut
            );
            
            // Update summary stats
            totalStaffEl.textContent = presentStaffList.length + mockAbsentStaff.length;
            presentStaffEl.textContent = presentStaffList.length;
            lateStaffEl.textContent = presentStaffList.filter(record => record.status === 'late').length;
            
            // Update present staff list
            presentListEl.innerHTML = '';
            if (presentStaffList.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="4" class="no-records">No staff have checked in yet today</td>`;
                presentListEl.appendChild(row);
            } else {
                presentStaffList.forEach(record => {
                    const row = document.createElement('tr');
                    
                    let statusIcon, statusText, statusClass;
                    if (record.status === 'late') {
                        statusIcon = '⚠️';
                        statusText = 'Late';
                        statusClass = 'status-late';
                    } else {
                        statusIcon = '✅';
                        statusText = 'On Time';
                        statusClass = 'status-on-time';
                    }
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${formatRoleName(record.role)}</td>
                        <td>${record.checkIn}</td>
                        <td class="${statusClass}">${statusIcon} ${statusText}</td>
                    `;
                    presentListEl.appendChild(row);
                });
            }
            
            // Update absent staff list
            absentListEl.innerHTML = '';
            // Filter staff who haven't checked in today
            const checkedInNames = new Set(presentStaffList.map(r => r.name));
            const trulyAbsentStaff = mockAbsentStaff.filter(staff => !checkedInNames.has(staff.name));
            
            if (trulyAbsentStaff.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="3" class="no-records">All staff have checked in today</td>`;
                absentListEl.appendChild(row);
            } else {
                trulyAbsentStaff.forEach(staff => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${staff.name}</td>
                        <td>${staff.role}</td>
                        <td class="status-late">❌ Absent</td>
                    `;
                    absentListEl.appendChild(row);
                });
            }
            
            // Update chart
            updateChart();
        }
        
        // Format role name for display
        function formatRoleName(role) {
            switch (role) {
                case 'teaching-assistant': return 'Teaching Assistant';
                case 'library-staff': return 'Library Staff';
                case 'redwood': return 'Redwood Department';
                case 'tailoring': return 'Tailoring Department';
                default: return role;
            }
        }
        
        // Export data to Excel
        function exportToExcel() {
            if (attendanceRecords.length === 0) {
                showNotification('No attendance records to export', 'error');
                return;
            }
            
            // Prepare data for export
            const exportData = attendanceRecords.map(record => ({
                'Date': record.date,
                'Name': record.name,
                'Role': formatRoleName(record.role),
                'Check-In': record.checkIn || '-',
                'Check-Out': record.checkOut || '-',
                'Status': record.status === 'late' ? 'Late' : record.checkIn ? 'On Time' : '-'
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Attendance Records');
            
            // Generate file name with date
            const dateStr = new Date().toISOString().split('T')[0];
            const fileName = `Kiwimbi_Kenya_Attendance_${dateStr}.xlsx`;
            
            // Download the file
            XLSX.writeFile(wb, fileName);
            
            showNotification('Attendance records exported successfully');
        }
        
        // Tab functionality
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and content
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Show corresponding content
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });
        
        // Initialize chart
        let attendanceChart;
        function initChart() {
            const ctx = document.getElementById('attendance-chart').getContext('2d');
            attendanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                    datasets: [{
                        label: 'Staff Present',
                        data: [12, 14, 13, 15, 10, 8],
                        backgroundColor: '#2e7d32',
                        borderColor: '#1b5e20',
                        borderWidth: 1
                    }, {
                        label: 'Late Arrivals',
                        data: [3, 2, 4, 1, 2, 1],
                        backgroundColor: '#d32f2f',
                        borderColor: '#c62828',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Staff'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Day of Week'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Weekly Attendance Summary'
                        },
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }
        
        // Update chart with current data
        function updateChart() {
            if (!attendanceChart) return;
            
            // For demo purposes, we'll use sample data based on today
            const day = getCurrentDay();
            const dayIndex = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].indexOf(day);
            
            if (dayIndex !== -1) {
                const presentData = [...attendanceChart.data.datasets[0].data];
                const lateData = [...attendanceChart.data.datasets[1].data];
                
                // Update today's values
                presentData[dayIndex] = presentStaffList.length;
                lateData[dayIndex] = presentStaffList.filter(r => r.status === 'late').length;
                
                attendanceChart.data.datasets[0].data = presentData;
                attendanceChart.data.datasets[1].data = lateData;
                attendanceChart.update();
            }
        }
        
        // Event listeners
        checkInBtn.addEventListener('click', checkIn);
        checkOutBtn.addEventListener('click', checkOut);
        exportBtn.addEventListener('click', exportToExcel);
        
        // Initialize the app
        function init() {
            updateCurrentDate();
            updateAttendanceDisplay();
            initChart();
            
            // Update time every minute
            setInterval(updateCurrentDate, 60000);
        }
        
        // Start the app
        window.addEventListener('load', init);
    </script>
</body>
</html>
